<?xml version="1.0" encoding="utf-8"?>
<!--
  Satellite Model with Reaction Wheels + Thrusters
  
  Actuator Configuration:
  - 3 Reaction Wheels (X, Y, Z axes) for attitude control
  - 6 Thrusters (2 per axis) for translation control
  
  State Vector (16 elements):
  - Position: [x, y, z] (3)
  - Quaternion: [qw, qx, qy, qz] (4)  
  - Linear velocity: [vx, vy, vz] (3)
  - Angular velocity: [wx, wy, wz] (3)
  - Reaction wheel speeds: [ωrx, ωry, ωrz] (3)
  
  Control Vector (9 elements):
  - Reaction wheel torques: [τx, τy, τz] (3)
  - Thruster forces: [F+x, F-x, F+y, F-y, F+z, F-z] (6)
-->
<mujoco model="satellite_rw">
  <compiler angle="degree" coordinate="local" inertiafromgeom="true"/>
  <option integrator="RK4" timestep="0.005" gravity="0 0 0"/>
  
  <visual>
    <global offwidth="2560" offheight="1440"/>
  </visual>

  <default>
    <joint armature="0" damping="0" limited="false"/>
    <geom conaffinity="0" condim="3" density="500" friction="1 0.5 0.5" 
          margin="0" material="geom" rgba="0.8 0.6 0.4 1"/>
    <site type="sphere" size="0.015" rgba="0.5 0.5 0.5 0.3"/>
  </default>

  <asset>
    <texture type="skybox" builtin="gradient" rgb1=".1 .1 .2" rgb2="0 0 0" 
             width="32" height="32"/>
    <texture name="grid" type="2d" builtin="checker" rgb1=".1 .2 .3" 
             rgb2=".2 .3 .4" width="512" height="512" mark="edge" markrgb=".8 .8 .8"/>
    <material name="grid" texture="grid" texrepeat="20 20" texuniform="true" reflectance=".2"/>
    <material name="geom" rgba="0.8 0.6 0.4 1"/>
    <material name="rw_material" rgba="0.3 0.3 0.3 1"/>
    <material name="thruster_active" rgba="1.0 0.3 0.1 0.9"/>
  </asset>

  <worldbody>
    <light cutoff="100" diffuse="1 1 1" dir="-0 0 -1.3" directional="true" 
           exponent="1" pos="0 0 1.3" specular="0.1 0.1 0.1"/>
    
    <!-- Floor for reference -->
    <geom name="floor" size="10 10 .05" type="plane" material="grid" pos="0 0 -3.0"/>

    <!-- Overhead Camera -->
    <camera name="overhead_cam" pos="0 0 4" mode="fixed" xyaxes="1 0 0 0 1 0"/>
    
    <!-- Tracking Camera -->
    <camera name="track_cam" pos="2 2 2" mode="trackcom" xyaxes="-0.707 0.707 0 -0.408 -0.408 0.816"/>
    
    <!-- Inspection Camera (wide view) -->
    <camera name="inspect_cam" pos="15 15 10" mode="fixed" fovy="60"/>

    <!-- ==================== TARGET SATELLITE ==================== -->
    <!-- Static body at origin (represents the target being inspected) -->
    <body name="target" pos="0 0 0">
      <geom name="target_body" type="box" size="0.5 0.5 0.5" 
            rgba="0.4 0.4 0.5 0.9" contype="0" conaffinity="0"/>
      <!-- Solar panels -->
      <geom name="solar_l" type="box" size="1.0 0.05 0.3" pos="-1.5 0 0"
            rgba="0.2 0.2 0.6 0.9" contype="0" conaffinity="0"/>
      <geom name="solar_r" type="box" size="1.0 0.05 0.3" pos="1.5 0 0"
            rgba="0.2 0.2 0.6 0.9" contype="0" conaffinity="0"/>
      <!-- Antenna -->
      <geom name="antenna" type="cylinder" size="0.05 0.4" pos="0 0 0.9"
            rgba="0.7 0.7 0.7 0.9" contype="0" conaffinity="0"/>
    </body>

    <body name="satellite" pos="0 0 0">
      <!-- 6-DOF Free Joint -->
      <joint name="root" type="free"/>
      
      <!-- Satellite Body (Box 30cm - half size 0.15m) -->
      <geom name="satellite_geom" type="box" size="0.15 0.15 0.15" mass="9.1" 
            rgba="0.7 0.7 0.8 0.85"/>
      
      <!-- ==================== REACTION WHEELS ==================== -->
      <!-- Each wheel: 0.3kg, 0.001 kg·m² inertia, max 6000 RPM -->
      
      <!-- X-axis Reaction Wheel -->
      <body name="rw_x" pos="0.08 0 0">
        <joint name="rw_x_joint" type="hinge" axis="1 0 0" 
               damping="0.0001" armature="0.001"/>
        <geom name="rw_x_geom" type="cylinder" size="0.025 0.008" mass="0.3"
              euler="0 90 0" material="rw_material"/>
      </body>
      
      <!-- Y-axis Reaction Wheel -->
      <body name="rw_y" pos="0 0.08 0">
        <joint name="rw_y_joint" type="hinge" axis="0 1 0"
               damping="0.0001" armature="0.001"/>
        <geom name="rw_y_geom" type="cylinder" size="0.025 0.008" mass="0.3"
              euler="90 0 0" material="rw_material"/>
      </body>
      
      <!-- Z-axis Reaction Wheel -->
      <body name="rw_z" pos="0 0 0.08">
        <joint name="rw_z_joint" type="hinge" axis="0 0 1"
               damping="0.0001" armature="0.001"/>
        <geom name="rw_z_geom" type="cylinder" size="0.025 0.008" mass="0.3"
              material="rw_material"/>
      </body>
      
      <!-- ==================== THRUSTERS ==================== -->
      <!-- 6 thrusters: 2 per axis for full 3D translation -->
      <!-- Each thruster: ~0.45N force -->
      
      <!-- +X face thruster (pushes -X) -->
      <site name="thruster_px" pos="0.15 0 0" rgba="1 0.2 0.2 0.3"/>
      
      <!-- -X face thruster (pushes +X) -->
      <site name="thruster_mx" pos="-0.15 0 0" rgba="1 0.2 0.2 0.3"/>
      
      <!-- +Y face thruster (pushes -Y) -->
      <site name="thruster_py" pos="0 0.15 0" rgba="0.2 1 0.2 0.3"/>
      
      <!-- -Y face thruster (pushes +Y) -->
      <site name="thruster_my" pos="0 -0.15 0" rgba="0.2 1 0.2 0.3"/>
      
      <!-- +Z face thruster (pushes -Z) -->
      <site name="thruster_pz" pos="0 0 0.15" rgba="0.2 0.2 1 0.3"/>
      
      <!-- -Z face thruster (pushes +Z) -->
      <site name="thruster_mz" pos="0 0 -0.15" rgba="0.2 0.2 1 0.3"/>
      
    </body>
  </worldbody>

  <!-- ==================== ACTUATORS ==================== -->
  <actuator>
    <!-- Reaction Wheel Torque Actuators -->
    <!-- Max torque: 0.1 N·m (increased for faster attitude control) -->
    <motor name="rw_x_torque" joint="rw_x_joint" gear="1" 
           ctrlrange="-0.1 0.1" ctrllimited="true"/>
    <motor name="rw_y_torque" joint="rw_y_joint" gear="1"
           ctrlrange="-0.1 0.1" ctrllimited="true"/>
    <motor name="rw_z_torque" joint="rw_z_joint" gear="1"
           ctrlrange="-0.1 0.1" ctrllimited="true"/>
  </actuator>

  <!-- ==================== SENSORS ==================== -->
  <sensor>
    <!-- Reaction wheel speed sensors -->
    <jointvel name="rw_x_speed" joint="rw_x_joint"/>
    <jointvel name="rw_y_speed" joint="rw_y_joint"/>
    <jointvel name="rw_z_speed" joint="rw_z_joint"/>
    
    <!-- Body state sensors -->
    <framepos name="sat_pos" objtype="body" objname="satellite"/>
    <framequat name="sat_quat" objtype="body" objname="satellite"/>
    <framelinvel name="sat_vel" objtype="body" objname="satellite"/>
    <frameangvel name="sat_angvel" objtype="body" objname="satellite"/>
  </sensor>

</mujoco>
