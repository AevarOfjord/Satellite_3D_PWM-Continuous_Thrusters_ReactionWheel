<?xml version="1.0" encoding="utf-8"?>
<!--
  Satellite Model with Reaction Wheels + Single Rear Thruster
  
  Actuator Configuration:
  - 3 Reaction Wheels (X, Y, Z axes) for attitude control
  - 1 Thruster (Rear face, pushing +X) for forward translation
  
  State Vector (16 elements):
  - Position: [x, y, z] (3)
  - Quaternion: [qw, qx, qy, qz] (4)  
  - Linear velocity: [vx, vy, vz] (3)
  - Angular velocity: [wx, wy, wz] (3)
  - Reaction wheel speeds: [ωrx, ωry, ωrz] (3)
  
  Control Vector (5 elements):
  - Reaction wheel torques: [tau_x, tau_y, tau_z] (3)
  - Thruster forces: [F_forward, F_brake] (2)
-->
<mujoco model="satellite_1thruster_rw">
  <compiler angle="degree" coordinate="local" inertiafromgeom="true"/>
  <option integrator="RK4" timestep="0.005" gravity="0 0 0"/>
  
  <visual>
    <global offwidth="2560" offheight="1440"/>
  </visual>

  <default>
    <joint armature="0" damping="0" limited="false"/>
    <geom conaffinity="0" condim="3" density="500" friction="1 0.5 0.5" 
          margin="0" material="geom" rgba="0.8 0.6 0.4 1"/>
    <site type="sphere" size="0.015" rgba="0.5 0.5 0.5 0.3"/>
  </default>

  <asset>
    <texture type="skybox" builtin="gradient" rgb1=".1 .1 .2" rgb2="0 0 0" 
             width="32" height="32"/>
    <texture name="grid" type="2d" builtin="checker" rgb1=".1 .2 .3" 
             rgb2=".2 .3 .4" width="512" height="512" mark="edge" markrgb=".8 .8 .8"/>
    <material name="grid" texture="grid" texrepeat="20 20" texuniform="true" reflectance=".2"/>
    <material name="geom" rgba="0.8 0.6 0.4 1"/>
    <material name="rw_material" rgba="0.3 0.3 0.3 1"/>
    <material name="thruster_active" rgba="1.0 0.3 0.1 0.9"/>
  </asset>

  <worldbody>
    <light cutoff="100" diffuse="1 1 1" dir="-0 0 -1.3" directional="true" 
           exponent="1" pos="0 0 1.3" specular="0.1 0.1 0.1"/>
    
    <!-- Floor for reference -->
    <geom name="floor" size="10 10 .05" type="plane" material="grid" pos="0 0 -3.0"/>

    <!-- Overhead Camera -->
    <camera name="overhead_cam" pos="0 0 4" mode="fixed" xyaxes="1 0 0 0 1 0"/>
    
    <!-- Tracking Camera -->
    <camera name="track_cam" pos="2 2 2" mode="trackcom" xyaxes="-0.707 0.707 0 -0.408 -0.408 0.816"/>
    
    <!-- Inspection Camera (wide view) -->
    <camera name="inspect_cam" pos="15 15 10" mode="fixed" fovy="60"/>

    <!-- ==================== TARGET SATELLITE ==================== -->
    <body name="target" pos="0 0 0">
      <geom name="target_body" type="box" size="0.5 0.5 0.5" 
            rgba="0.4 0.4 0.5 0.9" contype="0" conaffinity="0"/>
      <!-- Solar panels -->
      <geom name="solar_l" type="box" size="1.0 0.05 0.3" pos="-1.5 0 0"
            rgba="0.2 0.2 0.6 0.9" contype="0" conaffinity="0"/>
      <geom name="solar_r" type="box" size="1.0 0.05 0.3" pos="1.5 0 0"
            rgba="0.2 0.2 0.6 0.9" contype="0" conaffinity="0"/>
      <!-- Antenna -->
      <geom name="antenna" type="cylinder" size="0.05 0.4" pos="0 0 0.9"
            rgba="0.7 0.7 0.7 0.9" contype="0" conaffinity="0"/>
    </body>

    <body name="satellite" pos="0 0 0">
      <!-- 6-DOF Free Joint -->
      <joint name="root" type="free"/>
      
      <!-- Satellite Body (10kg, 0.29m cube) -->
      <geom name="satellite_geom" type="box" size="0.145 0.145 0.145" mass="9.1" 
            rgba="0.7 0.7 0.8 0.85"/>
      
      <!-- ==================== REACTION WHEELS ==================== -->
      <!-- X-axis Reaction Wheel -->
      <body name="rw_x" pos="0.08 0 0">
        <joint name="rw_x_joint" type="hinge" axis="1 0 0" 
               damping="0.0001" armature="0.001"/>
        <geom name="rw_x_geom" type="cylinder" size="0.025 0.008" mass="0.3"
              euler="0 90 0" material="rw_material"/>
      </body>
      
      <!-- Y-axis Reaction Wheel -->
      <body name="rw_y" pos="0 0.08 0">
        <joint name="rw_y_joint" type="hinge" axis="0 1 0"
               damping="0.0001" armature="0.001"/>
        <geom name="rw_y_geom" type="cylinder" size="0.025 0.008" mass="0.3"
              euler="90 0 0" material="rw_material"/>
      </body>
      
      <!-- Z-axis Reaction Wheel -->
      <body name="rw_z" pos="0 0 0.08">
        <joint name="rw_z_joint" type="hinge" axis="0 0 1"
               damping="0.0001" armature="0.001"/>
        <geom name="rw_z_geom" type="cylinder" size="0.025 0.008" mass="0.3"
              material="rw_material"/>
      </body>
      
      <!-- ==================== THRUSTERS ==================== -->
      <!-- Rear thruster: on -X face, pushing +X (forward) -->
      <site name="thruster_main" pos="-0.145 0 0" rgba="1 0.2 0.2 0.3"/>
      
      <!-- Front thruster: on +X face, pushing -X (backward/braking) -->
      <site name="thruster_brake" pos="0.145 0 0" rgba="0.2 0.2 1 0.3"/>
      
    </body>
  </worldbody>

  <!-- ==================== ACTUATORS ==================== -->
  <actuator>
    <!-- Reaction Wheel Torque Actuators (0.5 N·m max) -->
    <motor name="rw_x_torque" joint="rw_x_joint" gear="0.5" 
           ctrlrange="-1 1" ctrllimited="true"/>
    <motor name="rw_y_torque" joint="rw_y_joint" gear="0.5"
           ctrlrange="-1 1" ctrllimited="true"/>
    <motor name="rw_z_torque" joint="rw_z_joint" gear="0.5"
           ctrlrange="-1 1" ctrllimited="true"/>
    
    <!-- Main Thruster: rear face (-X), pushing forward (+X direction) -->
    <!-- gear="0.5 0 0 0 0 0" applies force in +X direction, max 0.5N -->
    <general name="thruster_main_force" site="thruster_main" 
             gear="0.5 0 0 0 0 0" 
             ctrlrange="0 1" ctrllimited="true"/>
    
    <!-- Brake Thruster: front face (+X), pushing backward (-X direction) -->
    <!-- gear="-0.5 0 0 0 0 0" applies force in -X direction, max 0.5N -->
    <general name="thruster_brake_force" site="thruster_brake" 
             gear="-0.5 0 0 0 0 0" 
             ctrlrange="0 1" ctrllimited="true"/>
  </actuator>

  <!-- ==================== SENSORS ==================== -->
  <sensor>
    <jointvel name="rw_x_speed" joint="rw_x_joint"/>
    <jointvel name="rw_y_speed" joint="rw_y_joint"/>
    <jointvel name="rw_z_speed" joint="rw_z_joint"/>
    
    <framepos name="sat_pos" objtype="body" objname="satellite"/>
    <framequat name="sat_quat" objtype="body" objname="satellite"/>
    <framelinvel name="sat_vel" objtype="body" objname="satellite"/>
    <frameangvel name="sat_angvel" objtype="body" objname="satellite"/>
  </sensor>

</mujoco>
